<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>make a movie by javascript</title>
	<style>
		html,body {
			height: 100%;
		}
		body {
			margin: 0;
			font-size:0;
		}
		img{
			width: 100%;
			height:100%;
		}
		* {
			transition: all 0.3s;
		}
	</style>
</head>
<body>
	<img id="img" src="/1.png">
	<audio id="audio" src="/下定决心去做就行吖.m4a" ></audio>
	<img src="/2.png" style="display: none">
	<img src="/3.png" style="display: none">
	<img src="/4.png" style="display: none">
	<img src="/5.png" style="display: none">
	
	
	<script type="text/javascript" src="https://cdn.jsdelivr.net/bluebird/latest/bluebird.js"></script>
	<script>
		var count = 0
		var audioFlag = 0
		var imgFlag = 0
		document.getElementById('audio').oncanplaythrough = function () {
			console.log('audio onload')
			audioFlag = 1
			if (imgFlag) {
				play()
				
			}
		}
		document.getElementById('img').onload = function () {
			console.log('onload')
			imgFlag = 1
			if (count==0 && audioFlag) {
				play()
			}
		}
		function changeImg(src,cb) {
			document.getElementById('img').setAttribute('src',src)	
			cb&&cb()
		}

		function play() {
			document.getElementById('audio').play()
				setTimeoutChangeImg('/2.png',3000).then(function () {
					return setTimeoutChangeImg('/3.png',3200)
				}).then(function () {
					return setTimeoutChangeImg('/4.png',4000)
				}).then(function () {
					return setTimeoutChangeImg('/5.png',3500)
				})	
				count++	
		}
		
		// function init() {
		// 	setTimeout(function () {
		// 		changeImg('2.png',function () {
		// 			setTimeout(function () {
		// 				changeImg('3.png',function () {
		// 					setTimeout(function () {
		// 						changeImg('4.png',function () {
		// 							setTimeout(function () {
		// 								changeImg('5.png')
		// 							},1000)
		// 						})
		// 					},1000)
		// 				})
		// 			},1000)	
		// 		})
		// 	},1000)	
		// }

		// init()
		
		function setTimeoutChangeImg(src,time) {
			time = time || 1000
			return new Promise(function (resolve,reject) {
				setTimeout(function () {
					changeImg(src)
					resolve()
				},time)
			})
		}

		// setTimeoutChangeImg('2.png').then(function () {
		// 	setTimeoutChangeImg('3.png').then(function () {
		// 		setTimeoutChangeImg('4.png').then(function () {
		// 			setTimeoutChangeImg('5.png').then(function () {
		// 			})	
		// 		})
		// 	})
		// })			
		
	</script>
</body>
</html>